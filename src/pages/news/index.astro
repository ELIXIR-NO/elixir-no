---
import MainLayout from '@layouts/MainLayout.astro';
import Searchbar from '@components/topNavMenu/Searchbar.astro';
import { getLastUrlSegment } from '@utils/url';
import { searchQueryString } from 'src/globalVariables';

const summaries = await Astro.glob('/src/pages/news/summaries/*.md');
const contents = await Astro.glob('/src/pages/news/contents/*.md');
const news = summaries.map(summary => ({
	summary,
	content: contents.find(
		content =>
			getLastUrlSegment(content.file) === getLastUrlSegment(summary.file)
	),
}));
const search = Astro.url.searchParams.get(searchQueryString);
---

<MainLayout title="News">
	<div class="flex flex-col">
		{
			news
				.filter(data =>
					RegExp(search || '', 'gi').test(data.content?.rawContent())
				)
				.map(data => (
					<article
						class="mb-5 mt-5"
						set:html={data.summary.compiledContent()}
					/>
				))
		}
	</div>
</MainLayout>
